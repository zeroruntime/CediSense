{% extends layout_path %} {% load humanize %} {% load static %} {% load i18n %} {% block title %}Dashboard{% endblock %}
{% block vendor_css %} {{ block.super }}
<link rel="stylesheet" href="{% static 'vendor/libs/apex-charts/apex-charts.css' %}" />
{% endblock vendor_css %} {% block vendor_js %} {{ block.super }}
<script src="{% static 'vendor/libs/apex-charts/apexcharts.js' %}"></script>
<script>
  /* eslint-disable */

  'use strict';
  (function () {
    let cardColor, headingColor, legendColor, labelColor, shadeColor, borderColor;

    cardColor = config.colors.cardColor;
    headingColor = config.colors.headingColor;
    legendColor = config.colors.bodyColor;
    labelColor = config.colors.textMuted;
    borderColor = config.colors.borderColor;
    // const incomeData = JSON.parse("{{ income_totals|safe }}");
    // const expenseData = JSON.parse("{{ expense_totals|safe }}");
    // const monthData = JSON.parse('{{ months|safe }}');

  // Income & Expenses Chart - Bar Chart
  // --------------------------------------------------------------------
    const incomeChartEl = document.querySelector('#incomeChart'),
      incomeChartConfig = {
        series: [
          {
            name: "Income",
            data: [{% for entry in income_by_month %} {{ entry.total }}, {% endfor %}],
          },
          ],
        chart: {
            height: 350,
              parentHeightOffset: 0,
              parentWidthOffset: 0,
                  toolbar: {
                    show: false
                  },
              type: 'bar'
        },
        dataLabels: {
          enabled: true
        },
        colors: [config.colors.primary],

        xaxis: {
          categories: [{% for entry in income_by_month_named %} '{{ entry.month }}', {% endfor %}],
          title: {
            text: 'Month'
          }
              },
        yaxis: {
          title: {
            text: 'Amount'
          }
        }
    };
  if (typeof incomeChartEl !== undefined && incomeChartEl !== null) {
    const incomeChart = new ApexCharts(incomeChartEl, incomeChartConfig);
    incomeChart.render();
  }

  const expenseChartEl = document.querySelector('#expenseChart'),
    expenseChartConfig = {
      series: [
        {
          name: "Expense",
          data: [{% for entry in expense_by_month %} {{ entry.total }}, {% endfor %}],
            },
          ],
      chart: {
        height: 350,
          parentHeightOffset: 0,
            parentWidthOffset: 0,
              toolbar: {
          show: false
        },
        type: 'bar'
      },
      dataLabels: {
        enabled: true
      },
      colors: [config.colors.primary],

      xaxis: {
        categories: [{% for entry in expense_by_month_named %} '{{ entry.month }}', {% endfor %}],
      title: {
        text: 'Month'
      }
              },
      yaxis: {
        title: {
          text: 'Amount'
        }
      }
        };
  if (typeof expenseChartEl !== undefined && expenseChartEl !== null) {
    const expenseChart = new ApexCharts(expenseChartEl, expenseChartConfig);
    expenseChart.render();
  }

  // Income & Expenses Mini Chart - Radial Chart
  // --------------------------------------------------------------------
  const weeklyIncomeEl = document.querySelector('#incomeOfWeek'),
    weeklyIncomeConfig = {
      series: [{{ income_this_week|default:0 }}],
      chart: {
        width: 60,
          height: 60,
            type: 'radialBar'
      },
      plotOptions: {
        radialBar: {
          startAngle: 0,
            endAngle: 360,
              strokeWidth: '10',
                hollow: {
            margin: 2,
              size: '50%'
          },
          track: {
            background: borderColor
          },
          dataLabels: {
            show: true,
              name: {
              show: false
            },
            value: {
              formatter: function (val) {
                return '₵' + parseInt(val);
              },
              offsetY: 5,
                color: legendColor,
                  fontSize: '12px',
                    fontFamily: 'Public Sans',
                      show: true
            }
          }
        }
      },
      fill: {
        type: 'solid',
          colors: config.colors.primary
      },
      stroke: {
        lineCap: 'round'
      },
      grid: {
        padding: {
          top: -10,
            bottom: -15,
              left: -10,
                right: -10
        }
      },
      states: {
        hover: {
          filter: {
            type: 'none'
          }
        },
        active: {
          filter: {
            type: 'none'
          }
        }
      }
      };
  if (typeof weeklyIncomeEl !== undefined && weeklyIncomeEl !== null) {
    const weeklyIncome = new ApexCharts(weeklyIncomeEl, weeklyIncomeConfig);
    weeklyIncome.render();
  }

  const weeklyExpensesEl = document.querySelector('#expensesOfWeek'),
    weeklyExpensesConfig = {
      series: [{{ expense_this_week|default:0 }}],
      chart: {
        width: 60,
          height: 60,
            type: 'radialBar'
      },
      plotOptions: {
        radialBar: {
          startAngle: 0,
            endAngle: 360,
              strokeWidth: '8',
                hollow: {
            margin: 2,
              size: '50%'
          },
          track: {
            background: borderColor
          },
          dataLabels: {
            show: true,
              name: {
              show: false
            },
            value: {
              formatter: function (val) {
                return '₵' + parseInt(val);
              },
              offsetY: 5,
                color: legendColor,
                  fontSize: '12px',
                    fontFamily: 'Public Sans',
                      show: true
            }
          }
        }
      },
      fill: {
        type: 'solid',
          colors: config.colors.primary
      },
      stroke: {
        lineCap: 'round'
      },
      grid: {
        padding: {
          top: -10,
            bottom: -15,
              left: -10,
                right: -10
        }
      },
      states: {
        hover: {
          filter: {
            type: 'none'
          }
        },
        active: {
          filter: {
            type: 'none'
          }
        }
      }
      };
  if (typeof weeklyExpensesEl !== undefined && weeklyExpensesEl !== null) {
    const weeklyExpenses = new ApexCharts(weeklyExpensesEl, weeklyExpensesConfig);
    weeklyExpenses.render();
  }

  $('#chartTabs button').on('shown.bs.tab', function (e) {
    var targetTab = $(e.target).attr('id');  // Get the ID of the tab that was clicked
    if (targetTab === 'chart2Tab') {
      // Initialize Week 2 chart only when it's visible
      weeklyExpenses.render();
    }
  });

  // Income & Expenses Chart - Pie Chart
  // --------------------------------------------------------------------

    const financeData = {
      income: {{ income_cat_list|safe }},
    expenses: {{ expense_cat_list|safe }}
  };

    // Store chart instances
    let incomeChart = null;
    let expenseChart = null;

    function processChartData(data, maxCategories = 8) {
        const sortedData = [...data].sort((a, b) => b.amount - a.amount);
        const total = sortedData.reduce((sum, item) => sum + item.amount, 0);
        
        if (sortedData.length > maxCategories) {
            const mainCategories = sortedData.slice(0, maxCategories - 1);
            const otherCategories = sortedData.slice(maxCategories - 1);
            const othersSum = otherCategories.reduce((sum, item) => sum + item.amount, 0);
            
            mainCategories.push({
                category: `Others (${otherCategories.length} categories)`,
                amount: othersSum,
                breakdown: otherCategories
            });
            
            return { processedData: mainCategories, total };
        }
        
        return { processedData: sortedData, total };
    }

    function createChartOptions(data, title) {
        const { processedData, total } = processChartData(data);
        
        return {
            series: processedData.map(item => item.amount),
            chart: {
                type: 'pie',
                height: 350
            },
            labels: processedData.map(item => item.category),
            title: {
                text: title,
                align: 'center',
                style: { fontSize: '20px' }
            },
            legend: {
                position: 'bottom',
                fontSize: '14px'
            },
            plotOptions: {
                pie: {
                    donut: {
                        size: '65%'
                    }
                }
            },
            responsive: [{
                breakpoint: 480,
                options: {
                    chart: { width: 300 },
                    legend: { position: 'bottom' }
                }
            }],
            tooltip: {
                y: {
                    formatter: value => '$' + value.toFixed(2)
                },
                custom: function({ dataPointIndex }) {
                    const data = processedData[dataPointIndex];
                    if (data.breakdown) {
                        const breakdownHtml = data.breakdown
                            .map(item => `${item.category}: $${item.amount.toFixed(2)}`)
                            .join('<br>');
                        return `
                            <div class="custom-tooltip">
                                <strong>${data.category}</strong><br>
                                Total: $${data.amount.toFixed(2)}<br>
                                <br>Breakdown:<br>
                                ${breakdownHtml}
                            </div>
                        `;
                    }
                    return `
                        <div class="custom-tooltip">
                            <strong>${data.category}</strong><br>
                            $${data.amount.toFixed(2)} (${((data.amount/total)*100).toFixed(1)}%)
                        </div>
                    `;
                }
            }
        };
    }

    function createPieChart(elementId, data, title, totalElementId) {
        const { processedData, total } = processChartData(data);
        const options = createChartOptions(data, title);
        
        // Create new chart
        const chart = new ApexCharts(document.querySelector(elementId), options);
        chart.render();
        
        // Update total amount
        document.querySelector(totalElementId).innerHTML = `Total: $${total.toFixed(2)}`;
        
        return chart;
    }

    // Initialize income chart immediately
    document.addEventListener('DOMContentLoaded', function() {
        incomeChart = createPieChart("#incomePieChart", financeData.income, "Income Distribution", "#incomeTotalAmount");
    });

    // Handle tab changes
    const tabEl = document.getElementById('PiechartTabs');
    tabEl.addEventListener('shown.bs.tab', function (event) {
        const targetTab = event.target.id;
        
        // Initialize expense chart when expense tab is shown
        if (targetTab === 'Piechart2Tab' && !expenseChart) {
            // Small delay to ensure container is visible
            setTimeout(() => {
                expenseChart = createPieChart("#expensesPieChart", financeData.expenses, "Expense Distribution", "#expenseTotalAmount");
            }, 50);
        }
    });

    })();
</script>
{% endblock vendor_js %} {% block page_js %} {{ block.super }} {% comment %}
<script src="{% static 'js/dashboards-analytics.js' %}"></script>
{% endcomment %} {% endblock page_js %} {% block content %}

<div class="row">
  <div class="col-xxl-8 mb-6 order-0">
    <div class="card">
      <div class="d-flex align-items-start row">
        <div class="col-sm-7">
          <div class="card-body">
            {% if request.user.is_authenticated %} {% if request.user.first_name %}
            <h5 class="card-title text-primary mb-3">Welcome Back {{request.user.first_name}}!</h5>
            {% else %} Welcome, Admin! {% endif %} {% endif %}
            <!-- <p class="mb-6">You have done 72% more sales today.<br>Check your new badge in your profile.</p>


            <a href="javascript:;" class="btn btn-sm btn-outline-primary">View Badges</a> -->
          </div>
        </div>
        <div class="col-sm-5 text-center text-sm-left">
          <div class="card-body pb-0 px-0 px-md-6">
            <img src="{% static 'img/illustrations/man-with-laptop.png' %}" height="120" alt="View Badge User" />
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sales & Profits -->
  <!-- <div class="col-lg-4 col-md-4 order-1">
    <div class="row">
      <div class="col-lg-6 col-md-12 col-6 mb-6">
        <div class="card h-100">
          <div class="card-body">
            <div class="card-title d-flex align-items-start justify-content-between mb-4">
              <div class="avatar flex-shrink-0">
                <img src="{% static 'img/icons/unicons/chart-success.png' %}" alt="chart success" class="rounded">
              </div>
              <div class="dropdown">
                <button class="btn p-0" type="button" id="cardOpt3" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="bx bx-dots-vertical-rounded text-muted"></i>
                </button>
                <div class="dropdown-menu dropdown-menu-end" aria-labelledby="cardOpt3">
                  <a class="dropdown-item" href="javascript:void(0);">View More</a>
                  <a class="dropdown-item" href="javascript:void(0);">Delete</a>
                </div>
              </div>
            </div>
            <p class="mb-1">Profit</p>
            <h4 class="card-title mb-3">$12,628</h4>
            <small class="text-success fw-medium"><i class='bx bx-up-arrow-alt'></i> +72.80%</small>
          </div>
        </div>
      </div>
      <div class="col-lg-6 col-md-12 col-6 mb-6">
        <div class="card h-100">
          <div class="card-body">
            <div class="card-title d-flex align-items-start justify-content-between mb-4">
              <div class="avatar flex-shrink-0">
                <img src="{% static 'img/icons/unicons/wallet-info.png' %}" alt="wallet info" class="rounded">
              </div>
              <div class="dropdown">
                <button class="btn p-0" type="button" id="cardOpt6" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <i class="bx bx-dots-vertical-rounded text-muted"></i>
                </button>
                <div class="dropdown-menu dropdown-menu-end" aria-labelledby="cardOpt6">
                  <a class="dropdown-item" href="javascript:void(0);">View More</a>
                  <a class="dropdown-item" href="javascript:void(0);">Delete</a>
                </div>
              </div>
            </div>
            <p class="mb-1">Sales</p>
            <h4 class="card-title mb-3">$4,679</h4>
            <small class="text-success fw-medium"><i class='bx bx-up-arrow-alt'></i> +28.42%</small>
          </div>
        </div>
      </div>
    </div>
  </div> -->
  <!-- Sales & Profits -->

  <!-- Total Revenue -->
  <!-- <div class="col-12 col-xxl-8 order-2 order-md-3 order-xxl-2 mb-6">
    <div class="card">
      <div class="row row-bordered g-0">
        <div class="col-lg-8">
          <div class="card-header d-flex align-items-center justify-content-between">
            <div class="card-title mb-0">
              <h5 class="m-0 me-2">Total Revenue</h5>
            </div>
            <div class="dropdown">
              <button class="btn p-0" type="button" id="totalRevenue" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="bx bx-dots-vertical-rounded bx-lg text-muted"></i>
              </button>
              <div class="dropdown-menu dropdown-menu-end" aria-labelledby="totalRevenue">
                <a class="dropdown-item" href="javascript:void(0);">Select All</a>
                <a class="dropdown-item" href="javascript:void(0);">Refresh</a>
                <a class="dropdown-item" href="javascript:void(0);">Share</a>
              </div>
            </div>
          </div>
          <div id="totalRevenueChart" class="px-3"></div>
        </div>
        <div class="col-lg-4 d-flex align-items-center">
          <div class="card-body px-xl-9">
            <div class="text-center mb-6">
              <div class="btn-group">
                <button type="button" class="btn btn-outline-primary">
                  <script>
                  document.write(new Date().getFullYear() - 1)

                  </script>
                </button>
                <button type="button" class="btn btn-outline-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                  <span class="visually-hidden">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu">
                  <li><a class="dropdown-item" href="javascript:void(0);">2021</a></li>
                  <li><a class="dropdown-item" href="javascript:void(0);">2020</a></li>
                  <li><a class="dropdown-item" href="javascript:void(0);">2019</a></li>
                </ul>
              </div>
            </div>

            <div id="growthChart"></div>
            <div class="text-center fw-medium my-6">62% Company Growth</div>

            <div class="d-flex gap-3 justify-content-between">
              <div class="d-flex">
                <div class="avatar me-2">
                  <span class="avatar-initial rounded-2 bg-label-primary"><i class="bx bx-dollar bx-lg text-primary"></i></span>
                </div>
                <div class="d-flex flex-column">
                  <small>
                    <script>
                    document.write(new Date().getFullYear() - 1)

                    </script>
                  </small>
                  <h6 class="mb-0">$32.5k</h6>
                </div>
              </div>
              <div class="d-flex">
                <div class="avatar me-2">
                  <span class="avatar-initial rounded-2 bg-label-info"><i class="bx bx-wallet bx-lg text-info"></i></span>
                </div>
                <div class="d-flex flex-column">
                  <small>
                    <script>
                    document.write(new Date().getFullYear() - 2)

                    </script>
                  </small>
                  <h6 class="mb-0">$41.2k</h6>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div> -->
  <!--/ Total Revenue -->
  <div class="col-12 col-md-8 col-lg-12 col-xxl-4 order-3 order-md-2">
    <div class="row">
      <div class="col-6 mb-6">
        <div class="card h-100">
          <div class="card-body">
            <div class="card-title d-flex align-items-start justify-content-between mb-4">
              <div class="avatar flex-shrink-0">
                <img src="{% static 'img/icons/unicons/paypal.png' %}" alt="paypal" class="rounded" />
              </div>
              <div class="dropdown">
                <button class="btn p-0" type="button" id="cardOpt4" data-bs-toggle="dropdown" aria-haspopup="true"
                  aria-expanded="false">
                  <i class="bx bx-dots-vertical-rounded text-muted"></i>
                </button>
                <div class="dropdown-menu dropdown-menu-end" aria-labelledby="cardOpt4">
                  <a class="dropdown-item" href="{% url 'transactions' %}">View More</a>
                </div>
              </div>
            </div>
            <p class="mb-1">Total Income</p>
            <h4 class="card-title mb-3">₵{{total_income|floatformat:2|intcomma}}</h4>
            <!-- <small class="text-danger fw-medium"><i class='bx bx-down-arrow-alt'></i> -14.82%</small> -->
          </div>
        </div>
      </div>
      <div class="col-6 mb-6">
        <div class="card h-100">
          <div class="card-body">
            <div class="card-title d-flex align-items-start justify-content-between mb-4">
              <div class="avatar flex-shrink-0">
                <img src="{% static 'img/icons/unicons/cc-primary.png' %}" alt="Credit Card" class="rounded" />
              </div>
              <div class="dropdown">
                <button class="btn p-0" type="button" id="cardOpt1" data-bs-toggle="dropdown" aria-haspopup="true"
                  aria-expanded="false">
                  <i class="bx bx-dots-vertical-rounded text-muted"></i>
                </button>
                <div class="dropdown-menu" aria-labelledby="cardOpt1">
                  <a class="dropdown-item" href="{% url 'transactions' %}">View More</a>
                </div>
              </div>
            </div>
            <p class="mb-1">Total Expenses</p>
            <h4 class="card-title mb-3">₵{{total_expenses|floatformat:2|intcomma}}</h4>
            <!-- <small class="text-success fw-medium"><i class='bx bx-up-arrow-alt'></i> +28.14%</small> -->
          </div>
        </div>
      </div>
      <div class="col-12 mb-6">
        <div class="card h-100">
          <div class="card-body">
            <div class="card-title d-flex align-items-start justify-content-between mb-4">
              <div class="avatar flex-shrink-0">
                <img src="{% static 'img/icons/unicons/cc-primary.png' %}" alt="Credit Card" class="rounded" />
              </div>
              <div class="dropdown">
                <button class="btn p-0" type="button" id="cardOpt1" data-bs-toggle="dropdown" aria-haspopup="true"
                  aria-expanded="false">
                  <i class="bx bx-dots-vertical-rounded text-muted"></i>
                </button>
                <div class="dropdown-menu" aria-labelledby="cardOpt1">
                  <a class="dropdown-item" href="javascript:void(0);">View More</a>
                  <a class="dropdown-item" href="javascript:void(0);">Delete</a>
                </div>
              </div>
            </div>
            <p class="mb-1">Balance</p>
            <h4 class="card-title mb-3">₵{{balance|floatformat:2|intcomma}}</h4>
            <!-- <small class="text-success fw-medium"><i class='bx bx-up-arrow-alt'></i> +28.14%</small> -->
          </div>
        </div>
      </div>
      <!-- <div class="col-12 mb-6">
        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center flex-sm-row flex-column gap-10">
              <div class="d-flex flex-sm-column flex-row align-items-start justify-content-between">
                <div class="card-title mb-6">
                  <h5 class="text-nowrap mb-1">Profile Report</h5>
                  <span class="badge bg-label-warning">YEAR 2022</span>
                </div>
                <div class="mt-sm-auto">
                  <span class="text-success text-nowrap fw-medium"><i class='bx bx-up-arrow-alt'></i> 68.2%</span>
                  <h4 class="mb-0">$84,686k</h4>
                </div>
              </div>
              <div id="profileReportChart"></div>
            </div>
          </div>
        </div>
      </div> -->
    </div>
  </div>
</div>

<div class="row">
  <!-- Order Statistics -->
  <!-- <div class="col-md-6 col-lg-4 col-xl-4 order-0 mb-6">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between">
        <div class="card-title mb-0">
          <h5 class="mb-1 me-2">Order Statistics</h5>
          <p class="card-subtitle">42.82k Total Sales</p>
        </div>
        <div class="dropdown">
          <button class="btn text-muted p-0" type="button" id="orederStatistics" data-bs-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            <i class="bx bx-dots-vertical-rounded bx-lg"></i>
          </button>
          <div class="dropdown-menu dropdown-menu-end" aria-labelledby="orederStatistics">
            <a class="dropdown-item" href="javascript:void(0);">Select All</a>
            <a class="dropdown-item" href="javascript:void(0);">Refresh</a>
            <a class="dropdown-item" href="javascript:void(0);">Share</a>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-6">
          <div class="d-flex flex-column align-items-center gap-1">
            <h3 class="mb-1">8,258</h3>
            <small>Total Orders</small>
          </div>
          <div id="orderStatisticsChart"></div>
        </div>
        <ul class="p-0 m-0">
          <li class="d-flex align-items-center mb-5">
            <div class="avatar flex-shrink-0 me-3">
              <span class="avatar-initial rounded bg-label-primary"><i class='bx bx-mobile-alt'></i></span>
            </div>
            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
              <div class="me-2">
                <h6 class="mb-0">Electronic</h6>
                <small>Mobile, Earbuds, TV</small>
              </div>
              <div class="user-progress">
                <h6 class="mb-0">82.5k</h6>
              </div>
            </div>
          </li>
          <li class="d-flex align-items-center mb-5">
            <div class="avatar flex-shrink-0 me-3">
              <span class="avatar-initial rounded bg-label-success"><i class='bx bx-closet'></i></span>
            </div>
            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
              <div class="me-2">
                <h6 class="mb-0">Fashion</h6>
                <small>T-shirt, Jeans, Shoes</small>
              </div>
              <div class="user-progress">
                <h6 class="mb-0">23.8k</h6>
              </div>
            </div>
          </li>
          <li class="d-flex align-items-center mb-5">
            <div class="avatar flex-shrink-0 me-3">
              <span class="avatar-initial rounded bg-label-info"><i class='bx bx-home-alt'></i></span>
            </div>
            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
              <div class="me-2">
                <h6 class="mb-0">Decor</h6>
                <small>Fine Art, Dining</small>
              </div>
              <div class="user-progress">
                <h6 class="mb-0">849k</h6>
              </div>
            </div>
          </li>
          <li class="d-flex align-items-center">
            <div class="avatar flex-shrink-0 me-3">
              <span class="avatar-initial rounded bg-label-secondary"><i class='bx bx-football'></i></span>
            </div>
            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
              <div class="me-2">
                <h6 class="mb-0">Sports</h6>
                <small>Football, Cricket Kit</small>
              </div>
              <div class="user-progress">
                <h6 class="mb-0">99</h6>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div> -->
  <!--/ Order Statistics -->

  <!-- Expense Overview -->
  <div class="col-md-6 col-lg-6 order-1 mb-6">
    <div class="card h-100">
      <div class="card-header nav-align-top">
        <ul class="nav nav-pills" role="tablist" id="chartTabs">
          <li class="nav-item">
            <button type="button" class="nav-link active" role="tab" data-bs-toggle="tab"
              data-bs-target="#navs-tabs-line-card-income" aria-controls="navs-tabs-line-card-income"
              aria-selected="true">
              Income
            </button>
          </li>
          <li class="nav-item">
            <button type="button" class="nav-link" role="tab" data-bs-toggle="tab"
              data-bs-target="#navs-tabs-line-card-expense" aria-controls="navs-tabs-line-card-expense"
              aria-selected="true" id="chart2Tab">
              Expenses
            </button>
          </li>
        </ul>
      </div>
      <div class="card-body">
        <div class="tab-content p-0">
          <div class="tab-pane fade show active" id="navs-tabs-line-card-income" role="tabpanel">
            <div class="d-flex mb-6">
              <div class="avatar flex-shrink-0 me-3">
                <img src="{% static 'img/icons/unicons/wallet.png' %}" alt="User" />
              </div>
              <div>
                <p class="mb-0">Total Income</p>
                <div class="d-flex align-items-center">
                  <h6 class="mb-0 me-1">₵{{total_income|floatformat:2|intcomma}}</h6>
                  <small class="text-success fw-medium">
                    <i class="bx bx-chevron-up bx-lg"></i>
                    42.9%
                  </small>
                </div>
              </div>
            </div>
            <div id="incomeChart"></div>
            <div class="d-flex align-items-center justify-content-center mt-6 gap-3">
              <div class="flex-shrink-0">
                <div id="incomeOfWeek"></div>
              </div>
              <div>
                <h6 class="mb-0">Income this week</h6>
              </div>
            </div>
          </div>
        </div>
        <div class="tab-content p-0">
          <div class="tab-pane fade" id="navs-tabs-line-card-expense" role="tabpanel">
            <div class="d-flex mb-6">
              <div class="avatar flex-shrink-0 me-3">
                <img src="{% static 'img/icons/unicons/wallet.png' %}" alt="User" />
              </div>
              <div>
                <p class="mb-0">Total Expenses</p>
                <div class="d-flex align-items-center">
                  <h6 class="mb-0 me-1">₵{{total_expenses|floatformat:2|intcomma}}</h6>
                  <small class="text-success fw-medium">
                    <i class="bx bx-chevron-up bx-lg"></i>
                    42.9%
                  </small>
                </div>
              </div>
            </div>
            <div id="expenseChart"></div>
            <div class="d-flex align-items-center justify-content-center mt-6 gap-3">
              <div class="flex-shrink-0">
                <div id="expensesOfWeek"></div>
              </div>
              <div>
                <h6 class="mb-0">Expense this week</h6>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--/ Expense Overview -->

    <!-- Pie Chart Overview -->
    <div class="col-md-6 col-lg-6 order-1 mb-6">
      <div class="card h-100">
        <div class="card-header nav-align-top">
          <ul class="nav nav-pills" role="tablist" id="PiechartTabs">
            <li class="nav-item">
              <button type="button" class="nav-link active" role="tab" data-bs-toggle="tab"
                data-bs-target="#navs-tabs-line-card-income2" aria-controls="navs-tabs-line-card-income2"
                aria-selected="true">
                Income
              </button>
            </li>
            <li class="nav-item">
              <button type="button" class="nav-link" role="tab" data-bs-toggle="tab"
                data-bs-target="#navs-tabs-line-card-expense2" aria-controls="navs-tabs-line-card-expense2"
                aria-selected="true" id="Piechart2Tab">
                Expenses
              </button>
            </li>
          </ul>
        </div>
        <div class="card-body">
          <div class="tab-content p-0">
            <div class="tab-pane fade show active" id="navs-tabs-line-card-income2" role="tabpanel">
              <div class="d-flex mb-6">
                <div class="avatar flex-shrink-0 me-3">
                  <img src="{% static 'img/icons/unicons/wallet.png' %}" alt="User" />
                </div>
                <div>
                  <p class="mb-0">Total Income</p>
                  <div class="d-flex align-items-center">
                    <h6 class="mb-0 me-1">₵{{total_income|floatformat:2|intcomma}}</h6>
                    <small class="text-success fw-medium">
                      <i class="bx bx-chevron-up bx-lg"></i>
                      42.9%
                    </small>
                  </div>
                </div>
              </div>
              <div id="incomePieChart"></div>
            </div>
          </div>
          <div class="tab-content p-0">
            <div class="tab-pane fade" id="navs-tabs-line-card-expense2" role="tabpanel">
              <div class="d-flex mb-6">
                <div class="avatar flex-shrink-0 me-3">
                  <img src="{% static 'img/icons/unicons/wallet.png' %}" alt="User" />
                </div>
                <div>
                  <p class="mb-0">Total Expense</p>
                  <div class="d-flex align-items-center">
                    <h6 class="mb-0 me-1">{{total_expenses|floatformat:2|intcomma}}</h6>
                    <small class="text-success fw-medium">
                      <i class="bx bx-chevron-up bx-lg"></i>
                      42.9%
                    </small>
                  </div>
                </div>
              </div>
              <div id="expensesPieChart"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--/ Pie Chart Overview -->

  <!-- Transactions -->
  <!-- <div class="col-md-6 col-lg-4 order-2 mb-6">
    <div class="card h-100">
      <div class="card-header d-flex align-items-center justify-content-between">
        <h5 class="card-title m-0 me-2">Transactions</h5>
        <div class="dropdown">
          <button class="btn text-muted p-0" type="button" id="transactionID" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <i class="bx bx-dots-vertical-rounded bx-lg"></i>
          </button>
          <div class="dropdown-menu dropdown-menu-end" aria-labelledby="transactionID">
            <a class="dropdown-item" href="javascript:void(0);">Last 28 Days</a>
            <a class="dropdown-item" href="javascript:void(0);">Last Month</a>
            <a class="dropdown-item" href="javascript:void(0);">Last Year</a>
          </div>
        </div>
      </div>
      <div class="card-body pt-4">
        <ul class="p-0 m-0">
          <li class="d-flex align-items-center mb-6">
            <div class="avatar flex-shrink-0 me-3">
              <img src="{% static 'img/icons/unicons/paypal.png' %}" alt="User" class="rounded">
            </div>
            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
              <div class="me-2">
                <small class="d-block">Paypal</small>
                <h6 class="fw-normal mb-0">Send money</h6>
              </div>
              <div class="user-progress d-flex align-items-center gap-2">
                <h6 class="fw-normal mb-0">+82.6</h6> <span class="text-muted">USD</span>
              </div>
            </div>
          </li>
          <li class="d-flex align-items-center mb-6">
            <div class="avatar flex-shrink-0 me-3">
              <img src="{% static 'img/icons/unicons/wallet.png' %}" alt="User" class="rounded">
            </div>
            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
              <div class="me-2">
                <small class="d-block">Wallet</small>
                <h6 class="fw-normal mb-0">Mac'D</h6>
              </div>
              <div class="user-progress d-flex align-items-center gap-2">
                <h6 class="fw-normal mb-0">+270.69</h6> <span class="text-muted">USD</span>
              </div>
            </div>
          </li>
          <li class="d-flex align-items-center mb-6">
            <div class="avatar flex-shrink-0 me-3">
              <img src="{% static 'img/icons/unicons/chart.png' %}" alt="User" class="rounded">
            </div>
            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
              <div class="me-2">
                <small class="d-block">Transfer</small>
                <h6 class="fw-normal mb-0">Refund</h6>
              </div>
              <div class="user-progress d-flex align-items-center gap-2">
                <h6 class="fw-normal mb-0">+637.91</h6> <span class="text-muted">USD</span>
              </div>
            </div>
          </li>
          <li class="d-flex align-items-center mb-6">
            <div class="avatar flex-shrink-0 me-3">
              <img src="{% static 'img/icons/unicons/cc-primary.png' %}" alt="User" class="rounded">
            </div>
            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
              <div class="me-2">
                <small class="d-block">Credit Card</small>
                <h6 class="fw-normal mb-0">Ordered Food</h6>
              </div>
              <div class="user-progress d-flex align-items-center gap-2">
                <h6 class="fw-normal mb-0">-838.71</h6> <span class="text-muted">USD</span>
              </div>
            </div>
          </li>
          <li class="d-flex align-items-center mb-6">
            <div class="avatar flex-shrink-0 me-3">
              <img src="{% static 'img/icons/unicons/wallet.png' %}" alt="User" class="rounded">
            </div>
            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
              <div class="me-2">
                <small class="d-block">Wallet</small>
                <h6 class="fw-normal mb-0">Starbucks</h6>
              </div>
              <div class="user-progress d-flex align-items-center gap-2">
                <h6 class="fw-normal mb-0">+203.33</h6> <span class="text-muted">USD</span>
              </div>
            </div>
          </li>
          <li class="d-flex align-items-center">
            <div class="avatar flex-shrink-0 me-3">
              <img src="{% static 'img/icons/unicons/cc-warning.png' %}" alt="User" class="rounded">
            </div>
            <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
              <div class="me-2">
                <small class="d-block">Mastercard</small>
                <h6 class="fw-normal mb-0">Ordered Food</h6>
              </div>
              <div class="user-progress d-flex align-items-center gap-2">
                <h6 class="fw-normal mb-0">-92.45</h6> <span class="text-muted">USD</span>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div> -->
  <!--/ Transactions -->

 <!-- Recent Transactions -->
 <div class="mt-5 mb-6">
  <h4 class="mb-4">Recent Transactions</h4>

  <div class="card shadow-sm">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead>
            <tr>
              <th>Type</th>
              <th>Category</th>
              <th>Date</th>
              <th>Description</th>
              <th class="text-end">Amount</th>
            </tr>
          </thead>
          <tbody>
            {% for transaction in last_10_transactions %}
              <tr>
                <td>
                  {% if transaction.category__type == 'Income' %}
                    <span class="badge bg-success">Income</span>
                  {% else %}
                    <span class="badge bg-danger">Expense</span>
                  {% endif %}
                </td>
                <td>{{ transaction.category__name }}</td>
                <td>{{ transaction.date|date:"F j, Y" }}</td>
                <td>
                  <span class="text-muted">{{ transaction.description|default:"No description" }}</span>
                </td>
                <td class="text-end {% if transaction.category__type == 'Income' %}text-success{% else %}text-danger{% endif %}">
                  {% if transaction.category__type == 'Expense' %}
                  -{{ transaction.amount|floatformat:2 }}
                {% else %}
                  {{ transaction.amount|floatformat:2 }}
                {% endif %}                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="5" class="text-center">
                  <div class="alert alert-info mb-0">No transactions found.</div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


{% endblock %}